{% extends "ht_header.html" %}

{% block head %}
	{{ super() }}
	<link type="text/css" rel="stylesheet" href="/static/css/signup.css">
	<link type="text/css" rel="stylesheet" href="/static/css/master.css">
	<script type="text/javascript" src="/static/js/signup.js"></script>
{% endblock %}


{% block content %}

<div class="signupContentWrapper">
	<h2>Register for Insprite</h2>
<!-- 
	<div class="signupSwitch">
		<div class="signupSwitchEmail signupSwitchActive">Email Signup</div>
		<div class="signupSwitchSocial">Social Signup</div>
	</div>
 -->
	<div class="signupEmail">
		<form id="SignupNow" action="/signup" onsubmit="return validateForm();" method="POST">

			{% if form.errors %}
			<div class="formError">Please fill out all fields</div>
			{% endif %}
			<div class="formCheck">Please fill out all fields</div>

			{{form.hidden_tag()}}
			{{form.input_signup_name(id="signupName", placeholder="Name", class="formField")}}
			{{form.input_signup_email(id="signupEmail", placeholder="Email", class="formField")}}
			{{form.input_signup_location(id="signupLocation", class="formField")}}
			{{form.input_signup_password(id="signupPassword", placeholder="Enter Password", class="formField")}}
			{{form.input_signup_confirm(id="signupConfirm", placeholder="Confirm Password", class="formField")}}
			<div id="passMeter"></div>

			<div class="signupAcceptTOS">
				{{form.accept_tos(class="checkbox formField")}} <label for="accept_tos" class="checkbox-label">I agree to the <a href="/terms" target="_blank">Terms of Service</a></label>
			</div>
			<div class="signupEmailSubmitWrapper"><input type="submit" value="Join Now" class="button teal"></div>
		</form>	
	</div>

	{% if errmsg != none %}
		<script>
			openAlertWindow('{{errmsg}}')
		</script>
	{% endif %}

	<!--
	<h2>Or use these</h2>
	<div class="signupSocial">
		<form method="link" action="/signup/linkedin">
			<input type="submit" class="signupLinkedIn" name="signupLinkedIn" value="LinkedIn" target="_blank"> 
		</form>

		<form method="link" action="/signup/facebook">
			<input type="submit" class="signupFacebook" value="Facebook">
		</form>

		<div class="signupLinkedInNotice">			
			By clicking any of the buttons above, you confirm that you have read the <a href="terms" target="_blank">Terms of Service</a>, that you understand them, and that you agree to be bound by them.
		</div>
	</div>
	-->

	<a class="signupLink" href="/login">Already a member?</a>

</div>

<!-- Scripts -->
<script type="text/javascript" src="/static/js/zxcvbn.js"></script>
<script type="text/javascript" src="/static/js/jquery.password.strength.js"></script>
<script type="text/javascript">


$.ajax({
	url: '//freegeoip.net/json/',
	type: 'POST',
	dataType: 'jsonp',
	success: function(location) {
		console.log(['city', location.city]);
		console.log(['region-code, name', location.region_code, location.region_name]);
		console.log(['areacode, zip', location.areacode, location.zipcode]);
		console.log(['ip', location.ip]);
		console.log(['lxl', location.latitude, location.longitude]);

		$('#signupLocation').append($('<option>', { 'value' : 'location_' + location.region_name.toLowerCase() }).text(location.region_name));
		//$('#signupLocation').options.add(new Option(location.region_name, 'location_' + location.region_name.toLowerCase()), $('#signupLocation').options[0]);
		// example where I update content on the page.
/*		jQuery('#country-name').html(location.country_name);
		jQuery('#country-code').html(location.country_code); */
	}
} );




// jquery pw-strength - http://www.sitepoint.com/developing-password-strength-plugin-jquery/
$(function() {
	$("#signupConfirm").keyup(  function() { initializeStrengthMeter(); } );
	$("#signupPassword").keyup( function() { if ($("#signupConfirm").val() != "") { initializeStrengthMeter(); } });
});

function initializeStrengthMeter() {
	$("#passMeter").PasswordStrengthManager({
		password: $("#signupPassword").val(),
		confirm_pass : $("#signupConfirm").val(),
		blackList : ["efewf"], 
		minChars : '5',
		maxChars : '25',
		advancedStrength : false
	});
}

function isNumberKey(evt) {
	var charCode = (evt.which) ? evt.which : event.keyCode;
	if (charCode > 31 && (charCode < 48 || charCode > 57))
	return false;
	return true;
}


function validateForm() {
	console.log("Validating");

	$(".formField").removeClass("formFieldError")

	// Fetch form elements
	var name = document.forms["SignupNow"]["signupName"];
	var email_address = document.forms["SignupNow"]["signupEmail"];
	var location = document.forms["SignupNow"]["signupLocation"];
	var password = document.forms["SignupNow"]["signupPassword"];
	var confirm  = document.forms["SignupNow"]["signupConfirm"];

	// Check for empty fields; if found, highlight them
	var form_error = 0;

	var form_fields = [name, email_address, location, password, confirm];
	for (var i = 0; i < form_fields.length; i++) {
		
		var current_element = form_fields[i];
		var current_value = form_fields[i].value;
		if (current_value.match(/^\s*$/)) {
			$(current_element).addClass("formFieldError");
			form_error = 1;
		}
		if (current_element == location){
			if (current_value == ""){
				$(current_element).addClass("formFieldError");
				form_error = 1;
			}
		}
	}
	

	// Validate email address
	if (isEmail(email_address)) {
		console.log("it's an email address.");
	} else {
		console.log("it's NOT an email address.");
		$(".signupEmail").addClass("formFieldError");
		form_error = 1;		
	}

	// Checks if the password is correct
	if (password.value !== confirm.value) {
		openAlertWindow("Your password and confirmation password don't match.");
		form_error = 1;
	}

	// Checks if the ToS checkbox is checked
	if (document.getElementById('accept_tos').checked) {return true;} else {
		openAlertWindow("You must agree to our Terms of Service in order to create an account.");
		form_error = 1;
	}

	if (form_error == 1) {
		return false;
	} else {
		console.log("ERROR IS NOT 1");
		return true;
	}
}

function isEmail(email) {
	console.log("testing email");
	var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	return regex.test(email);
}

</script>

<!-- Bottom bar -->

{% endblock %}
