{% extends "ht_header.html" %}

{% block head %}
	{{ super() }}
	<link type="text/css" rel="stylesheet" href="/static/css/profile.css">
	<!--script src="/static/js/profile.js"></script-->
	<script src="/static/js/lightbox.min.js"></script>
	<script src="/static/js/dropzone.js"></script>
	<script src="/static/js/dz.js"></script>
	<link type="text/css" rel="stylesheet" href="/static/css/lightbox.css">
	<link type="text/css" rel="stylesheet" href="/static/css/dropzone.css">
	<link type="text/css" rel="stylesheet" href="/static/css/dz.css">

{% endblock %}


{% block content %}

<div class="profileContentWrapper">

	<div class="profileHeaderColumn">
		<div class="profilePicContainer">
			<img class="profilePic" src="{{profile_img}}">
		</div>
	</div>


	<div class="profileLeftColumn">
		<div class="profileNameHeadline">
			<h1>{{hp.prof_name}}</h1>
			<h2>{{hp.headline| default('No headline')}}</h2>
			<h3>${{hp.prof_rate}}</h3>
		</div>
		<div class="profileMobileBlock">
			{% if hp is sameas bp %}
			<form method="link" action="/edit">
				<input type="submit" class="whiteButton" value="Edit Profile">
			</form>

			{% else %}

			<form method="link" action="/schedule" method="POST">
				<input type="hidden" name="hp" value="{{hp.prof_id}}">
				<input type="submit" class="blueButton" value="Schedule Lesson">
			</form>

			{% endif %}
			<div class="profileBasicInfo">
				<div class="profileInfoBox"><img src="/static/img/facebook_thumbnails.jpg"></div>
				<div class="profileInfoBox">{{hp.location}}</div>
				<div class="profileInfoBox">{{hp.industry}}</div>
				<div class="profileInfoBox">
			{% if hp.reviews == 0 %}
				No Reviews
			{% else %}
				{{ '%0.1f' | format(hp.rating|float) }} out of 5 stars <a href="#">({{hp.reviews}} Reviews)</a>
			{% endif %}
			</div>
			<!-- <div class="profileInfoBox"><a href="{{hp.prof_url}}" target="_blank">Personal Website</a></div> -->
		</div>
		</div>
		<div class="profileAboutMe">{{hp.prof_bio}}</div>

		{% if revs|count == 0 %}
		<h3>There are no reviews for this person yet.</h3>

		{% else %}
		<div class="profileReviews">
				<div class="profileReviewsInfo">
				<h3>Reviews ({{revs|length}})</h3>
				<!-- CAH: Write Review should appear if user has purchased time with the person.
					 CAH: Will make this happen later.  Currently, sent as an email.
				<a href="/postreview">Write Review</a>
				-->
			</div>
			<div class="profileLatestReviews">

				{% for review in revs %}
				<!-- The individual review box starts here -->
				<div class="profileReviewBox">
					<div class="profileReviewLeft">
						<div class="profileReviewImageWrap">
							<!-- Social Media icon. -->
							{% if loop.index == 1 %}
							<div class="profileReviewImageFacebook"></div>
							{% endif %}
							<a href="#" onclick="document.getElementById('h').value='{{review.display.prof_id}}'; document.p.submit();">
								<img src="https://s3-us-west-1.amazonaws.com/htfileupload/htfileupload/{{review.display.prof_img}}">
							</a>
						</div>
						
						<div class="profileReviewLeftNameHeadline">
							<a href="#" onclick="document.getElementById('h').value='{{review.display.prof_id}}'; document.p.submit();">
								<h3>{{review.display.prof_name}}</h3>
							</a>
							<h4>{{review.display.headline}}</h4>
						</div>
					</div>
					<div class="profileReviewRight">
						<div class="profileReviewRating">
							<div class="profileReviewRatingLabels">
								Overall Value<br>
								Promptness<br>
								Communication
							</div>
							<div class="profileReviewRatingDivider"></div>
							<div class="profileReviewRatingBars">

								<!-- Overall Value -->
								<div class="profileReviewRatingBar">
									{% if review.Review.appt_score == 1 %}
										<div class="profileReviewRatingBarFillOne"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.appt_score}}/5</div>
									{% elif review.Review.appt_score == 2 %}
										<div class="profileReviewRatingBarFillTwo"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.appt_score}}/5</div>
									{% elif review.Review.appt_score == 3 %}
										<div class="profileReviewRatingBarFillThree"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.appt_score}}/5</div>
									{% elif review.Review.appt_score == 4 %}
										<div class="profileReviewRatingBarFillTwo"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.appt_score}}/5</div>
									{% elif review.Review.appt_score == 5 %}
										<div class="profileReviewRatingBarFillFive"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.appt_score}}/5</div>
									{% endif %}
								</div>

								<!-- Promptness goes here -->
								<div class="profileReviewRatingBar">
									{% if not review.Review.score_attr_time %}
										<div class="profileReviewRatingBarFillZero"></div>
										<div class="profileReviewRatingNumerical">n/a</div>
									{% elif review.Review.score_attr_time == 1 %}
										<div class="profileReviewRatingBarFillOne"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_time}}/5</div>
									{% elif review.Review.score_attr_time == 2 %}
										<div class="profileReviewRatingBarFillTwo"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_time}}/5</div>
									{% elif review.Review.score_attr_time == 3 %}
										<div class="profileReviewRatingBarFillThree"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_time}}/5</div>
									{% elif review.Review.score_attr_time == 4 %}
										<div class="profileReviewRatingBarFillFour"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_time}}/5</div>
									{% elif review.Review.score_attr_time == 5 %}
										<div class="profileReviewRatingBarFillFive"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_time}}/5</div>
									{% else %}
										<div class="profileReviewRatingNumerical"> SubZero </div>
									{% endif %}
								</div>

								<!-- Communication -->
								<div class="profileReviewRatingBar">
									{% if not review.Review.score_attr_comm %}
									  <div class="profileReviewRatingBarFillZero"></div>
									  <div class="profileReviewRatingNumerical"> n/a </div>
									{% elif review.Review.score_attr_comm == 1 %} 
										<div class="profileReviewRatingBarFillOne"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_comm}}/5</div>
									{% elif review.Review.score_attr_comm == 2 %} 
										<div class="profileReviewRatingBarFillTwo"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_comm}}/5</div>
									{% elif review.Review.score_attr_comm == 3 %} 
										<div class="profileReviewRatingBarFillThree"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_comm}}/5</div>
									{% elif review.Review.score_attr_comm == 4 %} 
										<div class="profileReviewRatingBarFillFour"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_comm}}/5</div>
									{% elif review.Review.score_attr_comm == 5 %} 
										<div class="profileReviewRatingBarFillFive"></div>
										<div class="profileReviewRatingNumerical">{{review.Review.score_attr_comm}}/5</div>
									{% endif %}
								</div>
								<!--div> {{review.appt.prop_ts.strftime('%B %Y')}} </div-->
							</div>
						</div>
						<div class="profileReviewBoxText">{{review.Review.generalcomments}}</div>
					</div>
					<div class="clear"></div>
				</div>
				{% endfor %}

			</div>
			<div class="profileReviewsInfo"></div>
		</div>
		{% endif %}
	</div>

	<div class="profileRightColumn">
		<div class="profilePriceBox">
			<span>$</span>
			<h1 id="profilePriceBoxRate">{{hp.prof_rate}}</h1>
			<div class="perHour">per<br>hour</div>
		</div>
		{% if hp is sameas bp %}
			<a href="/edit"><button id="edit-profile-button" class="whiteButton">Edit Profile</button></a>
		{% else %}
		<form method="link" action="/schedule" method="POST">
			<input type="hidden" name="hp" value="{{hp.prof_id}}">
			<input type="submit" class="blueButton" value="Schedule Lesson">
		</form>
		{% endif %}
		<div class="profileBasicInfo">
				<div class="profileInfoBox"><img src="/static/img/facebook_thumbnails.jpg"></div>
				<div class="profileInfoBox">{{hp.location}}</div>
				<div class="profileInfoBox">{{hp.industry}}</div>
				<div class="profileInfoBox">
					{% if hp.reviews == 0 %}
						No Reviews
					{% else %}
						{{ '%0.1f' | format(hp.rating|float) }} out of 5 stars <a href="#">({{hp.reviews}} Reviews)</a>
					{% endif %}
				</div>
				<!-- <div class="profileInfoBox"><a href="{{hp.prof_url}}" target="_blank">Personal Website</a></div> -->
		</div>

		{% if hp is sameas bp %}
			<a href="/multiple_uploader"><button id="portfolio-upload-button" class="whiteButton">Add Portfolio Images</button></a>
		{% endif %}

		<div class="profilePortfolio">
			<!--a href="/static/img/portfolio_acroyoga.jpg" data-lightbox="portfolio" data-title="I've been a certified acroyoga instructor for 10 years now." class="profilePortfolioImage acroyoga"></a-->
			{% for img in portfolio %}
				<a href="https://s3-us-west-1.amazonaws.com/htfileupload/htfileupload/{{img.img_id}}" style="background: url('https://s3-us-west-1.amazonaws.com/htfileupload/htfileupload/{{img.img_id}}') no-repeat center center; background-size:cover;" data-lightbox="portfolio" data-title="{{img.img_comment}}" class="profilePortfolioImage" ></a>

			{% endfor %}

			{% if hp is sameas bp %}
<!-- 			<div class="profilePortfolioImage addImage" id="addImage"><p>Add Portfolio Image</p></div>
			<input type="file" id="selectFile" name="selectFile" style="visibility: hidden; width: 0px; height: 0px" multiple /> -->
			{% endif %}
		</div>

	</div>

	{% if hp is sameas bp %}
	<!-- This doesn't work properly yet. Strange errors with the display / z-index when hiding/showing -->
	<div id="portfolio-upload" class="modal hidden" hidden>
		<div class="dzContentWrapper modal-content">
				<div class="modal-header">
			      	<a href="#" class="btn-close" aria-hidden="true">×</a>
			    </div>
			    <div class="modal-info">
					<h2>Upload Portfolio Images</h2>
					<h4>(Drag to re-order)</h4>
				</div>
				<div class="dropzone-wrapper">
					<form action="upload" method="post" class="dropzone dz-clickable square" id="upload-form">
						<input name="csrf_token" type="hidden" value="{{ csrf_token() }}">
						<div class="fallback">
					    	<input name="file" type="file" multiple />
					  	</div>
					</form>
				</div> 

				<div class="dropzone-content-submit">
					<button type="button" class="blueButton multiple-upload-button">
						Upload Images
					</button>
				</div>

				<form action="manage-portfolio" method="post" class="files-form">
				</form>
		</div>
	</div>

	{% endif %}

	<div class="clear"></div>
</div>

<script src="/static/js/dropzone.js"></script>
<script src="/static/js/dz.js"></script>	
<script>
$(function () {

	// $('#portfolio-upload-button').click(function(event) {
	// 	event.preventDefault();
	// 	$('#portfolio-upload').show();
	// });

	// $('.btn-close').click(function(event) {
	// 	event.preventDefault();
	// 	$('#portfolio-upload').hide();
	// });

    $('.addImage').click(function () {
		$('#selectFile').click();
		return false;
	});

	$('#selectFile').change(function(e) {
		//reloadProfImg("../static/img/loader.gif", true, false);
		var csrf = "{{ csrf_token() }}";
		var fd = new FormData();

		if (this.files[0] == undefined) {
			console.log('no file, quit');
			return false;
		}

		fd.append('file', this.files[0]);
		fd.append('orig', 'profile');

		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(e) {
			if (4 == this.readyState) {
				console.log(['xhr post complete, state=', this.status,  e]);
				if (this.status == 200) {
					console.log(xhr.responseText);
					openAlertWindow('Success.');
				} else if (this.status == 400) {
					console.log(['xhr post complete, err=400 ', e]);
					openAlertWindow('Fail.');
				} else if (this.status == 404) {
					console.log(['xhr post complete, err=404 ', e]);
					openAlertWindow('Fail.');
				} else if (this.status == 500) {
					console.log(['xhr post complete, err=500 ', e]);
					openAlertWindow('Fail.');
				} else if (this.status == 501) {
					console.log(['xhr post complete, err=501 ', e]);
					openAlertWindow('Fail.');
				} else {
					console.log('xhr post complete, uncaught');
					openAlertWindow('Failure: API point doesn\'t exist.');
				}
			}
		};

		if (xhr.upload) {
			xhr.upload.onprogress = function(e) {
				var done = e.position || e.loaded, total = e.totalSize || e.total;
				console.log('xhr.upload progress: ' + done + ' / ' + total + ' = ' + (Math.floor(done/total*1000)/10) + '%');
			};
		}

		xhr.open('POST', "/upload", true);
		xhr.setRequestHeader("X-CSRFToken", csrf);
		xhr.send(fd);
		return false;
	});
});//jQuery ready
</script>

{% endblock %}
