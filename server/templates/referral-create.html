{% extends 'sc-header.html' %}
{% set meta_title	= 'Refer a professional.' %}
{% set meta_desc	= 'Refer a professional on Soulcrafting.' %}


{% block header_css %}
	{{ super() }}
	{% assets "scss_referral" %}<link rel='stylesheet' href='{{ASSET_URL}}'>{% endassets %}
{% endblock %}

{% block content %}
<section id='invite'>
	<div class='h3 text-center'>Make a Referral.</div>

	<div id='refer_a_pro' class="form-group email">
		<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
		{{form.invite_emails(type='text', class='form-control typeahead', autocomplete='off', placeholder="Professional's name or phone number.")}}
		<!--input id='send_invite' type="submit" class="blueButton" value="Send"-->
	</div>
</section>
{% endblock %}


{% block scripts %}
	{{ super() }}
	<script src="/static/js/typeahead.bundle.js"></script>
	<script src="/static/js/referral.js"></script>
	<script src="/static/js/handlebars.js"></script>
	<script>
		$(document).ready(function () {
			$('#invite_emails').keydown(function(event) {
				if (event.keyCode == 13) {
					get_profile();
					return false;
					this.form.submit();
				 }
			});

			function get_profile() {
				alert( "Handler for submit() called." );
				console.log('here');
			}

			$('.typeahead').bind('typeahead:select', function(ev, suggestion) {

				var fd = {};
				fd.csrf_token = "{{ csrf_token() }}";
				console.log('selected: ' + suggestion.id + 'id?');

				$.ajax({url		: "/professional/" + suggestion.id + '/',
						type	: "POST",
						data	: fd,
						success : function(data) {
							console.log(data);
							//window.location.href = data.nexturl;
						},
						error	: function(data) {
							console.log("Oops, AJAX Error.");
						}
				})
			});
			{# $('.typeahead').bind('typeahead:render', function(ev, suggestion, flag, dataset, other) {   //code  }); #}
		});
	</script>
{% endblock %}
